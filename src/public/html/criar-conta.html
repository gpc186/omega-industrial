<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Petro - Cadastro</title>
    <link rel="stylesheet" href="../style/criar-conta.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.1.1/css/intlTelInput.css" />

</head>

<body>
    <header>
        <nav>
            <div class="nav-content">
                <div class="nav-img">
                    <img class="nav-img-logo" src="/src/public/assets/img/logo.png">
                </div>

                <div class="nav-navegacao">
                    <a href="produtos.html">
                        <p>Produtos</p>
                    </a>
                    <a href="">
                        <p>Dashboard</p>
                    </a>
                    <a href="">
                        <p>Carrinho</p>
                    </a>
                </div>
            </div>

            <div class="nav-content">
                <div class="nav-btn-container">
                    <a href="index.html"><button class="nav-btn-entrar">Voltar</button></a>
                </div>
            </div>
        </nav>
    </header>

    <div class="caixa">
        <div class="form-card">
            <h1 class="titulo">Dados de Acesso</h1>
            <p class="subtitulo">Preencha todos os campos obrigatórios para criar sua conta</p>

            <form id="form-cadastro">

                <div class="linha">
                    <div class="grupo-formulario">
                        <label>Empresa</label>
                        <input type="text" placeholder="Nome da empresa" required />
                    </div>

                    <div class="grupo-formulario">
                        <label>CNPJ</label>
                        <input type="text" id="cnpj" placeholder="00.000.000/0000-00" maxlength="18" required />
                    </div>
                </div>

                <div class="linha">
                    <div class="grupo-formulario">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="seu@email.com" required />
                    </div>

                    <div class="grupo-formulario">
                        <label>Telefone</label>
                        <input id="telefone" type="tel" required />
                    </div>

                </div>

                <div class="linha">
                    <div class="grupo-formulario">
                        <label>Senha</label>
                        <div class="senha">
                            <input type="password" id="senha1" placeholder="Digite sua senha" required />
                            <button type="button" class="button-imagem" onclick="toggleSenha('senha1','eyeIcon1')">
                                <div class="eye-icon eye-closed" id="eyeIcon1">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle class="eye-pupil" cx="12" cy="12" r="3"></circle>
                                        <line class="eye-slash" x1="3" y1="3" x2="21" y2="21"></line>
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div class="grupo-formulario">
                        <label>Confirmar Senha</label>
                        <div class="senha">
                            <input type="password" id="senha2" placeholder="Confirme sua senha" required />
                            <button type="button" class="button-imagem" onclick="toggleSenha('senha2','eyeIcon2')">
                                <div class="eye-icon eye-closed" id="eyeIcon2">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle class="eye-pupil" cx="12" cy="12" r="3"></circle>
                                        <line class="eye-slash" x1="3" y1="3" x2="21" y2="21"></line>
                                    </svg>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <button type="submit" class="enviar-btn">ENVIAR</button>
            </form>

            <div class="divisao">ou</div>

            <div class="criar-conta">
                <p class="criar-conta-texto">Já possui conta?</p>
                <a href="login.html" class="criar-conta-link">LOGIN</a>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.1.1/js/intlTelInput.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/google-libphonenumber/3.2.31/libphonenumber.js"></script>


    <script>
        // =========================
        //  TOGGLE SENHA
        // =========================
        function toggleSenha(inputId, eyeId) {
            const input = document.getElementById(inputId);
            const eye = document.getElementById(eyeId);

            if (input.type === "password") {
                input.type = "text";
                eye.classList.replace("eye-closed", "eye-open");
            } else {
                input.type = "password";
                eye.classList.replace("eye-open", "eye-closed");
            }
        }

        // =========================
        //  VALIDAÇÃO DE EMAIL
        // =========================
        document.getElementById("email").addEventListener("input", (e) => {
            // sem borda verde/vermelha
        });

        // =========================
        //  MÁSCARA DE CNPJ
        // =========================
        document.getElementById("cnpj").addEventListener("input", (e) => {
            let v = e.target.value.replace(/\D/g, "");
            v = v.replace(/(\d{2})(\d)/, "$1.$2");
            v = v.replace(/(\d{2})\.(\d{3})(\d)/, "$1.$2.$3");
            v = v.replace(/(\d{2})\.(\d{3})\.(\d{3})(\d)/, "$1.$2.$3/$4");
            v = v.replace(/(\d{2})\.(\d{3})\.(\d{3})\/(\d{4})(\d)/, "$1.$2.$3/$4-$5");
            e.target.value = v;
        });

        // =========================
        //  REMOVIDO: VERIFICAÇÃO DE CNPJ REAL
        // =========================

        // =========================
        //  TELEFONE INTERNACIONAL
        //  (SEM BORDAS VERDES/VERMELHAS)
        // =========================
        (function () {
            const input = document.getElementById("telefone");
            if (!input) return;

            const iti = intlTelInput(input, {
                initialCountry: "br",
                separateDialCode: true,
                nationalMode: true,
                autoInsertDialCode: true,
                autoPlaceholder: "aggressive",
                formatOnDisplay: false,
                utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.1.1/js/utils.js"
            });

            const phoneUtil = libphonenumber.PhoneNumberUtil.getInstance();
            const AsYouType = libphonenumber.AsYouTypeFormatter;
            const PNF = libphonenumber.PhoneNumberFormat;

            function getMaxDigits(countryIso) {
                try {
                    if (countryIso === "BR") return 11;
                    const exMobile = phoneUtil.getExampleNumberForType(countryIso, libphonenumber.PhoneNumberType.MOBILE);
                    const ex = exMobile || phoneUtil.getExampleNumber(countryIso);
                    if (!ex) return 15;
                    const formatted = phoneUtil.format(ex, PNF.NATIONAL);
                    return formatted.replace(/\D/g, "").length;
                } catch {
                    return 15;
                }
            }

            function formatUsingAsYouType(digits, countryIso) {
                const max = getMaxDigits(countryIso);
                if (digits.length > max) digits = digits.slice(0, max);

                try {
                    const fmt = new AsYouType(countryIso);
                    let out = "";
                    for (const d of digits) out = fmt.inputDigit(d);
                    return out;
                } catch {
                    return digits.replace(/(\d{3})(?=\d)/g, "$1 ");
                }
            }

            function formatBR(digits) {
                if (digits.length > 11) digits = digits.slice(0, 11);

                if (digits.length >= 3 && digits[2] !== "9") {
                    digits = digits.slice(0, 2) + "9" + digits.slice(2);
                    if (digits.length > 11) digits = digits.slice(0, 11);
                }

                if (digits.length <= 2) return digits;
                if (digits.length <= 6) return digits.replace(/^(\d{2})(\d+)/, "($1) $2");
                if (digits.length <= 10) return digits.replace(/^(\d{2})(\d{4})(\d+)/, "($1) $2-$3");

                return digits.replace(/^(\d{2})(\d{5})(\d{4}).*/, "($1) $2-$3");
            }

            let currentCountry = iti.getSelectedCountryData().iso2.toUpperCase();

            input.addEventListener("keydown", (e) => {
                const allowed = ["Backspace", "Delete", "ArrowLeft", "ArrowRight", "Home", "End", "Tab"];
                if (allowed.includes(e.key)) return;
                if (e.ctrlKey || e.metaKey) return;
                if (!/[0-9]/.test(e.key)) e.preventDefault();
            });

            input.addEventListener("paste", (ev) => {
                ev.preventDefault();
                const txt = (ev.clipboardData || window.clipboardData).getData('text') || '';
                const digits = txt.replace(/\D/g, '');
                handleAndSet(digits);
            });

            input.addEventListener("countrychange", () => {
                currentCountry = iti.getSelectedCountryData().iso2.toUpperCase();
                const digits = input.value.replace(/\D/g, "");
                handleAndSet(digits);
            });

            function handleAndSet(raw) {
                let digits = raw.replace(/\D/g, "");
                const country = currentCountry;

                if (country === "BR") {
                    input.value = formatBR(digits);
                    return;
                }

                input.value = formatUsingAsYouType(digits, country);
            }

            input.addEventListener("input", () => {
                handleAndSet(input.value);
            });

            handleAndSet(input.value || "");

        })();

        // =========================
        // SENHA + CONFIRMAR (SEM BORDAS)
        // =========================
        const s1 = document.getElementById("senha1");
        const s2 = document.getElementById("senha2");

        function validarSenhas() {
            return s1.value.length >= 6 && s1.value === s2.value;
        }

        s1.addEventListener("input", validarSenhas);
        s2.addEventListener("input", validarSenhas);

        // =========================
        //  VALIDAÇÃO FINAL NO SUBMIT
        // =========================
        document.getElementById("form-cadastro").addEventListener("submit", function (e) {

            const cnpj = document.getElementById("cnpj").value;
            const email = document.getElementById("email").value;
            const senha1 = document.getElementById("senha1").value;
            const senha2 = document.getElementById("senha2").value;
            const telefone = document.getElementById("telefone").value.replace(/\D/g, "");

            let erro = false;
            let msg = "";

            if (cnpj.replace(/\D/g, "").length < 14) {
                erro = true;
                msg = "CNPJ incompleto.";
            } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                erro = true;
                msg = "Email inválido.";
            } else if (telefone.length < 10) {
                erro = true;
                msg = "Telefone incompleto.";
            } else if (senha1 !== senha2) {
                erro = true;
                msg = "As senhas não coincidem.";
            } else if (senha1.length < 6) {
                erro = true;
                msg = "A senha deve ter pelo menos 6 caracteres.";
            }

            if (erro) {
                e.preventDefault();
                alert(msg);
            }
        });
    </script>




</body>

</html>